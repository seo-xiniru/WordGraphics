<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WordGraphics</title>
  <style>
    body{
      background:#ffffff;
      margin:0;
      font-family:Inter, 'Noto Sans KR', system-ui;
      display:grid;
      place-items:center;
      padding:24px;
    }
    .card{width:min(920px,96vw);background:#fff;border-radius:16px;padding:28px;box-shadow:0 8px 30px rgba(0,0,0,0.15);border:1px solid #ddd}
    h1{margin:0 0 12px 0;font-size:18px;color:#333}

    .input-wrap{display:flex;justify-content:center;margin-bottom:18px}
    textarea{width:100%;max-width:720px;padding:12px 14px;border-radius:10px;border:1px solid #ddd;background:#fafafa;color:#333;font-size:16px;resize:vertical;min-height:44px}

    .emoji-strip{
      display:flex;
      flex-wrap:wrap;
      gap:0;
      padding:0;
      margin:12px auto 0 auto;
      width:100%;
      max-width:1000px;
      background:transparent;
    }
    .emoji-img{
      display:block;
      object-fit:contain;
      margin:0;
      padding:0;
      flex: 0 0 auto;
    }

    .controls{display:flex;gap:8px;margin-top:12px}
    button{background:#f7f7f7;border:1px solid #ddd;padding:8px 12px;border-radius:8px;color:#333;cursor:pointer}

    .wordbook{margin-top:14px;background:#fafafa;border-radius:8px;padding:10px;overflow:hidden;max-height:0;opacity:0;transition:max-height .28s ease, opacity .2s ease;display:none}
    .wordbook.open{display:block;max-height:320px;opacity:1;overflow-y:auto}
    .word-item{display:flex;align-items:center;gap:10px;margin-bottom:8px;padding:6px 10px;border-radius:6px;background:#f5f5f5}
    .toggle-book{text-align:center;margin-top:10px;cursor:pointer;color:#666;font-size:14px}
  </style>
</head>
<body>
  <div class="card">
    <h1>WordGraphics</h1>

    <div class="input-wrap">
      <textarea id="typed" rows="3" placeholder="í…ìŠ¤íŠ¸ë¥¼ ìž…ë ¥í•˜ì„¸ìš” (í•œê¸€ ì§€ì›)"></textarea>
    </div>

    <div id="emojiStrip" class="emoji-strip" aria-live="polite"></div>

    <div class="controls">
      <button id="clearBtn">ì´ˆê¸°í™”</button>
      <button id="copyBtn">ì£¼ì†Œ ë³µì‚¬</button>
      <button id="saveBtn">ì €ìž¥</button>
    </div>

    <div class="toggle-book" id="toggleBook">ðŸ“˜ ë‹¨ì–´ìž¥ íŽ¼ì¹˜ê¸°</div>
    <div id="wordBook" class="wordbook"></div>
  </div>

  <script>
    const HANGUL_MAP = {
      'ã„±':'g','ã„²':'g','ã…‹':'k','ã„´':'n','ã„·':'d','ã„¸':'d','ã…Œ':'t',
      'ã„¹':'r','ã…':'m','ã…‚':'b','ã…ƒ':'b','ã…':'p','ã……':'s','ã…†':'s','ã…Ž':'h','ã…‡':'o',
      'ã…ˆ':'j','ã…‰':'j','ã…Š':'c','ã…':'a','ã…‘':'a','ã…“':'e','ã…•':'e','ã…—':'o','ã…›':'o',
      'ã…œ':'u','ã… ':'u','ã…¡':'u','ã…£':'i'
    };

    const textarea = document.getElementById('typed');
    const strip = document.getElementById('emojiStrip');
    const clearBtn = document.getElementById('clearBtn');
    const copyBtn = document.getElementById('copyBtn');
    const saveBtn = document.getElementById('saveBtn');
    const wordBook = document.getElementById('wordBook');
    const toggleBook = document.getElementById('toggleBook');

    let items = [];
    let wordList = [];
    let prevValue = '';
    let composing = false;

    function normalizeChar(ch){
      if(!ch) return null;
      if(/[a-zA-Z]/.test(ch)) return ch.toLowerCase();
      if(HANGUL_MAP[ch]) return HANGUL_MAP[ch];
      return null;
    }

    function render(){
      strip.innerHTML = '';
      if(items.length === 0){ strip.textContent = 'ìž…ë ¥ëœ ë¬¸ìžê°€ ì—†ìŠµë‹ˆë‹¤.'; return; }

      const baseSize = 100; // í•œ ì¤„ì— 10ê°œì¼ ë•Œ 100px
      const maxPerLine = 10;

      items.forEach((ch, idx) => {
        const img = document.createElement('img');
        img.src = `./zimg/${ch}.png`;
        img.className = 'emoji-img';
        img.style.width = baseSize + 'px';
        img.style.height = baseSize + 'px';
        img.alt = ch;
        img.style.marginRight = ((idx+1) % maxPerLine === 0) ? '0' : '0px';
        img.style.marginBottom = ((idx+1) % maxPerLine === 0) ? '4px' : '0';
        strip.appendChild(img);
      });
    }

    textarea.addEventListener('compositionstart', () => { composing = true; });
    textarea.addEventListener('compositionend', (ev) => { composing = false; handleInputChange(ev.target.value); });
    textarea.addEventListener('input', (ev) => { if(!composing) handleInputChange(ev.target.value); });

    function handleInputChange(current){
      if(current === prevValue) return;
      if(current.length < prevValue.length){
        const diff = prevValue.length - current.length;
        for(let i=0;i<diff;i++) items.pop();
        prevValue = current;
        render();
        return;
      }
      const added = current.slice(prevValue.length);
      for(const ch of added){
        const mapped = normalizeChar(ch);
        if(mapped) items.push(mapped);
      }
      prevValue = current;
      render();
    }

    textarea.addEventListener('keydown', (ev) => {
      if(ev.key === 'Backspace'){ setTimeout(()=>{ handleInputChange(textarea.value); },0); }
    });

    clearBtn.addEventListener('click', ()=>{ items=[]; wordList=[]; textarea.value=''; prevValue=''; render(); });

    copyBtn.addEventListener('click', async ()=>{
      const text = items.map(c=>`./zimg/${c}.png`).join('\n');
      await navigator.clipboard.writeText(text);
      copyBtn.textContent='ë³µì‚¬ë¨!';
      setTimeout(()=>copyBtn.textContent='ì£¼ì†Œ ë³µì‚¬',900);
    });

    saveBtn.addEventListener('click', ()=>{
      const text = textarea.value.trim();
      if(!text && items.length===0) return;
      wordList.push({ imgs:[...items], text });
      renderWordBook();
      items=[]; textarea.value=''; prevValue=''; render();
    });

    function renderWordBook(){
      wordBook.innerHTML='';
      if(wordList.length===0){ wordBook.textContent='ì €ìž¥ëœ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.'; return; }
      wordList.forEach(w=>{
        const row=document.createElement('div'); row.className='word-item';
        const imgDiv=document.createElement('div');
        w.imgs.forEach(i=>{ const img = document.createElement('img'); img.src=i; img.style.width='50px'; img.style.height='50px'; img.style.objectFit='contain'; imgDiv.appendChild(img); });
        const tx=document.createElement('div'); tx.textContent=w.text;
        row.appendChild(imgDiv); row.appendChild(tx); wordBook.appendChild(row);
      });
    }

    toggleBook.addEventListener('click', ()=>{
      if(wordBook.classList.contains('open')){
        wordBook.classList.remove('open');
        setTimeout(()=>wordBook.style.display='none',400);
        toggleBook.textContent='ðŸ“˜ ë‹¨ì–´ìž¥ íŽ¼ì¹˜ê¸°';
      } else {
        wordBook.style.display='block';
        setTimeout(()=>wordBook.classList.add('open'),10);
        toggleBook.textContent='ðŸ“• ë‹¨ì–´ìž¥ ì ‘ê¸°';
      }
    });

    render();
  </script>
</body>
</html>
